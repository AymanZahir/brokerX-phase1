# ADR-002 — Persistance : ORM + Repositories + Idempotence

**Statut**: Accepté

## Contexte
Les UC *Dépôt* et *Ordre* exigent intégrité et **idempotence** (rejouer une requête → même résultat). On veut des migrations reproductibles et des contraintes en base.

## Décision
- Utiliser un **ORM** (p. ex. JPA/Hibernate) encapsulé par des **Repositories** par agrégat
  (`AccountRepo`, `WalletRepo`, `OrderRepo`, `TransactionRepo`).
- Contraintes **uniques** :
  - `transaction.idempotencyKey`
  - `order.clientOrderId`
- Migrations SQL (ex. Flyway) pour créer tables, index et checks.

## Conséquences
- Transactions, contraintes et migrations gérées
- Tests d’intégration facilités, code d’accès aux données lisible
- Attention aux requêtes **N+1** et à l’indexation ; profils `dev/test` avec DB locale
